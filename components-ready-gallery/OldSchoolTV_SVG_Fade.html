<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OldSchoolTV_SVG_Fade</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
    <style> body { margin: 0; padding: 0; overflow: hidden; background: #000; } canvas { display: block; } </style>
</head>
<body>
    <script>
let svgVertices = [];
let svgAlpha = 0;
let fadeDirection = 1;
let time = 0;

function setup() {
  createCanvas(800, 600);
  colorMode(HSB, 360, 100, 100, 100);
  noStroke();
  generateRandomShape(12, 120);
}

function draw() {
  background(20, 80, 10);

  // --- Update animation variables ---
  time += 0.02;
  svgAlpha += fadeDirection * 0.75;
  if (svgAlpha > 100 || svgAlpha < 0) {
    fadeDirection *= -1;
  }
  svgAlpha = constrain(svgAlpha, 0, 100);

  // --- Draw the TV ---
  drawTV();

  // --- Draw content on the TV screen ---
  push();
  translate(width / 2, height / 2);

  // Screen glare and curvature simulation
  drawScreenCurvature();
  
  // Trippy SVG Animation
  drawTrippySVG();
  
  // Static and scanlines
  drawScreenEffects();

  pop();
}

function drawTV() {
  rectMode(CENTER);
  
  // TV Casing
  fill(40, 60, 25);
  rect(width / 2, height / 2, 650, 500, 50);
  
  // Inner bezel
  fill(30, 50, 15);
  rect(width / 2, height / 2, 620, 470, 40);

  // Screen
  fill(10, 10, 5);
  rect(width / 2, height / 2, 540, 410, 20);

  // Legs
  stroke(40, 60, 25);
  strokeWeight(20);
  line(width / 2 - 200, height / 2 + 250, width / 2 - 250, height / 2 + 300);
  line(width / 2 + 200, height / 2 + 250, width / 2 + 250, height / 2 + 300);
  noStroke();
  
  // Dials
  fill(40, 60, 40);
  ellipse(width/2 + 295, height/2 + 100, 40, 40);
  ellipse(width/2 + 295, height/2 + 160, 40, 40);
  fill(30, 60, 60);
  ellipse(width/2 + 295, height/2 + 100, 15, 15);
  ellipse(width/2 + 295, height/2 + 160, 15, 15);
}


function generateRandomShape(numVertices, maxRadius) {
  for (let i = 0; i < numVertices; i++) {
    let angle = map(i, 0, numVertices, 0, TWO_PI);
    let r = random(maxRadius * 0.6, maxRadius);
    let x = cos(angle) * r;
    let y = sin(angle) * r;
    svgVertices.push(createVector(x, y));
  }
}

function drawTrippySVG() {
  let hue = (frameCount * 0.5) % 360;
  let breathe = map(sin(time), -1, 1, 0.9, 1.1);
  let wobbleX = sin(time * 2.5) * 15;
  let wobbleY = cos(time * 1.8) * 15;

  push();
  translate(wobbleX, wobbleY);
  scale(breathe);
  rotate(time * 0.2);

  // Ghosting / Echo effect
  for (let i = 8; i > 0; i--) {
    let trailAlpha = svgAlpha * (i / 20.0);
    let trailScale = 1 + (8 - i) * 0.04;
    let trailHue = (hue + (8 - i) * 15) % 360;
    fill(trailHue, 90, 100, trailAlpha);
    push();
    scale(trailScale);
    drawShape(svgVertices);
    pop();
  }
  
  // Main shape with glow
  drawingContext.shadowBlur = 32;
  drawingContext.shadowColor = color(hue, 50, 100, 50);
  fill(hue, 80, 100, svgAlpha);
  drawShape(svgVertices);
  drawingContext.shadowBlur = 0; // Reset for other elements
  
  pop();
}

function drawShape(vertices) {
  beginShape();
  // Use first and last points to guide the curve
  curveVertex(vertices[vertices.length - 1].x, vertices[vertices.length - 1].y);
  for (const v of vertices) {
    curveVertex(v.x, v.y);
  }
  curveVertex(vertices[0].x, vertices[0].y);
  curveVertex(vertices[1].x, vertices[1].y);
  endShape(CLOSE);
}

function drawScreenEffects() {
  // Scanlines
  for (let y = -205; y < 205; y += 4) {
    fill(0, 0, 0, 30);
    rect(0, y, 540, 2);
  }

  // Static
  for (let i = 0; i < 250; i++) {
    let x = random(-270, 270);
    let y = random(-205, 205);
    let a = random(0, 20);
    fill(0, 0, 100, a);
    ellipse(x, y, random(1, 3));
  }
}

function drawScreenCurvature() {
    // Top-left glare
    beginShape();
    fill(0, 0, 100, 3);
    vertex(-270, -205);
    for(let i = 0; i <= 10; i++) {
        let amt = i / 10;
        let x = lerp(-270, 100, amt);
        let y = lerp(-205, -50, amt);
        let controlX = -270;
        let controlY = -50;
        let px = quadraticVertex(controlX, controlY, x, y);
    }
    endShape(CLOSE);

    // Subtle darkening on edges to fake curvature
    let gradSteps = 20;
    for(let i = 0; i < gradSteps; i++) {
        let amt = i / gradSteps;
        let alpha = amt * 1.5;
        let inset = amt * 80;
        noFill();
        strokeWeight(inset);
        stroke(0, 0, 0, alpha);
        rect(0, 0, 540, 410, 20);
    }
    noStroke();
}
    </script>
</body>
</html>
