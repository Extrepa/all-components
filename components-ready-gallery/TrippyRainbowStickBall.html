<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TrippyRainbowStickBall</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
    <style> body { margin: 0; padding: 0; overflow: hidden; background: #000; } canvas { display: block; } </style>
</head>
<body>
    <script>
let t = 0;
let particles = [];
const NUM_PARTICLES = 150;
const NUM_SEGMENTS = 12;

function setup() {
  createCanvas(800, 600);
  colorMode(HSB, 360, 100, 100, 100);
  strokeWeight(1.5);
  noFill();
  
  for(let i = 0; i < NUM_PARTICLES; i++) {
    particles.push(new Particle());
  }
}

function draw() {
  background(0, 0, 0, 3);
  
  translate(width / 2, height / 2);

  let timeFactor = map(mouseX, 0, width, 0.0001, 0.005, true);
  let noiseFactor = map(mouseY, 0, height, 0.5, 10, true);
  
  for(let i = 0; i < NUM_SEGMENTS; i++) {
    rotate(TWO_PI / NUM_SEGMENTS);
    
    for(let p of particles) {
      p.update(t, noiseFactor);
      p.display();
    }
    
    // Add mirrored symmetry for extra complexity
    push();
    scale(1, -1);
     for(let p of particles) {
      p.display();
    }
    pop();
  }
  
  t += timeFactor;
}

class Particle {
  constructor() {
    this.history = [];
    this.maxLen = 50;
    this.noiseOffsetX = random(1000);
    this.noiseOffsetY = random(1000);
    this.noiseOffsetZ = random(1000);
    this.colorOffset = random(360);
  }

  update(time, noiseFactor) {
    let angle = noise(this.noiseOffsetX + time * 0.5, this.noiseOffsetY) * TWO_PI * noiseFactor;
    let radius = noise(this.noiseOffsetY, this.noiseOffsetZ + time) * (width * 0.6);
    
    let x = cos(angle) * radius;
    let y = sin(angle) * radius;
    
    this.history.push(createVector(x, y));
    
    if (this.history.length > this.maxLen) {
      this.history.splice(0, 1);
    }
  }

  display() {
    beginShape();
    for (let i = 0; i < this.history.length; i++) {
      let pos = this.history[i];
      let hue = (t * 50 + this.colorOffset + i * 2) % 360;
      let sat = 90;
      let bri = 100;
      let alpha = map(i, 0, this.history.length, 0, 100);
      stroke(hue, sat, bri, alpha);
      
      let sw = map(i, 0, this.history.length, 0.5, 5);
      strokeWeight(sw * (0.5 + 0.5 * sin(t*20 + i*0.1)));

      curveVertex(pos.x, pos.y);
    }
    endShape();
  }
}

function mousePressed() {
    background(0);
    particles = [];
    for(let i = 0; i < NUM_PARTICLES; i++) {
        particles.push(new Particle());
    }
}
    </script>
</body>
</html>
